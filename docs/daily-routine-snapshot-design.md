# Daily Routine Snapshot ì„¤ê³„ ë¬¸ì„œ

## ğŸ“‹ ê°œìš”

### ëª©í‘œ
ì‚¬ìš©ìì˜ ì¼ì¼ ë£¨í‹´ ê¸°ë¡ì—ì„œ **ì™„ì „ì„±ê³¼ ì‹œê°„ì  ì¼ê´€ì„±**ì„ ë³´ì¥í•˜ê¸° ìœ„í•´, **ê¸°ë¡ ì €ì¥ ì‹œì ì—ë§Œ** í•´ë‹¹ ë‚ ì§œì˜ ëª¨ë“  í™œì„± ë£¨í‹´ì— ëŒ€í•œ ìŠ¤ëƒ…ìƒ·ì„ ìë™ ìƒì„±í•˜ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•©ë‹ˆë‹¤.

### í•´ê²°í•˜ë ¤ëŠ” ë¬¸ì œ
1. **ë¶ˆì™„ì „í•œ ê¸°ë¡ í‘œì‹œ**: ê¸°ë¡ì´ ìˆëŠ” ë‚ ì§œì—ì„œ ê¸°ë¡ë˜ì§€ ì•Šì€ ë£¨í‹´ì´ ì¡°íšŒ ì‹œ ëˆ„ë½ë¨
2. **ì‹œê°„ì  ë¶ˆì¼ì¹˜**: í•´ë‹¹ ë‚ ì§œ ê¸°ì¤€ ë£¨í‹´ ëª©ë¡ ìŠ¤ëƒ…ìƒ·ì´ ì—†ì–´ ë°ì´í„° ë¶ˆì¼ì¹˜ ë°œìƒ
3. **ì‚¬ìš©ì ê²½í—˜**: ê¸°ë¡ ì €ì¥í•œ ë‚ ì§œì˜ ëª¨ë“  ë£¨í‹´ ìƒíƒœ(ìˆ˜í–‰/ë¯¸ìˆ˜í–‰)ê°€ ëª…í™•í•˜ê²Œ í‘œì‹œë˜ì–´ì•¼ í•¨

### ê¸°íš ì œì•½ì¡°ê±´
- **ë‹¹ì¼ë§Œ ìˆ˜ì • ê°€ëŠ¥**: ì‚¬ìš©ìëŠ” ë‹¹ì¼ ë£¨í‹´ ê¸°ë¡ë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆìŒ
- **ê³¼ê±° ê¸°ë¡ ì¡°íšŒ ì œí•œ**: ê¸°ë¡ì´ ì—†ëŠ” ê³¼ê±° ë‚ ì§œëŠ” "ê¸°ë¡ ì—†ìŒ" ìƒíƒœë¡œ ì²˜ë¦¬

## ğŸ¯ í•µì‹¬ ìš”êµ¬ì‚¬í•­

### ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­
1. **ì™„ì „ì„±**: ê¸°ë¡ì„ ì €ì¥í•œ ë‚ ì§œì˜ ëª¨ë“  í™œì„± ë£¨í‹´ì´ í‘œì‹œë˜ì–´ì•¼ í•¨
2. **ì‹œê°„ì  ì¼ê´€ì„±**: ê¸°ë¡ ì €ì¥ ì‹œì ì˜ ë£¨í‹´ ëª©ë¡ ìŠ¤ëƒ…ìƒ· ë³´ì¡´
3. **ìë™í™”**: ì‚¬ìš©ì ê°œì… ì—†ì´ ìë™ìœ¼ë¡œ ìŠ¤ëƒ…ìƒ· ìƒì„±
4. **ë°ì´í„° ë³´ì¡´**: ë£¨í‹´ ì‚­ì œ í›„ì—ë„ í•´ë‹¹ ë‚ ì§œ ê¸°ë¡ì€ ìœ ì§€

### ì„±ëŠ¥ ìš”êµ¬ì‚¬í•­
1. **ì €ì¥ ì‹œì  ìƒì„±**: ê¸°ë¡ ì €ì¥ ì‹œì—ë§Œ ìŠ¤ëƒ…ìƒ· ìƒì„±
2. **íš¨ìœ¨ì„±**: ì¡°íšŒ ì‹œì ì˜ ë¶ˆí•„ìš”í•œ ë°ì´í„° ìƒì„± ë°©ì§€
3. **í™•ì¥ì„±**: ì‚¬ìš©ìê°€ ë§ì€ ë£¨í‹´ì„ ë³´ìœ í•´ë„ ì²˜ë¦¬ ê°€ëŠ¥

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ ì„¤ê³„

### A. í•˜ì´ë¸Œë¦¬ë“œ ìŠ¤ëƒ…ìƒ· íŒ¨í„´

#### ìŠ¤ëƒ…ìƒ· ìƒì„±/ì²˜ë¦¬ ì‹œì 
```
1. saveDailyRecord() í˜¸ì¶œ ì‹œ
   - í•´ë‹¹ ë‚ ì§œì— ê¸°ë¡ì´ ì—†ìœ¼ë©´ ì‹¤ì œ ìŠ¤ëƒ…ìƒ· ìƒì„± í›„ DB ì €ì¥ ì§„í–‰

2. getDailyRecord() ì¡°íšŒ ì‹œ
   - ë‹¹ì¼ ì¡°íšŒì´ê³  ê¸°ë¡ì´ ì—†ìœ¼ë©´ ê°€ìƒ NOT_PERFORMED ë ˆì½”ë“œ ìƒì„± (DB ì €ì¥ ì•ˆí•¨)
   - ê³¼ê±° ë‚ ì§œëŠ” ê¸°ì¡´ ì €ì¥ëœ ê¸°ë¡ë§Œ ì¡°íšŒ (ê¸°ë¡ ì—†ìœ¼ë©´ ë¹ˆ ì‘ë‹µ)
```

#### ì¥ì 
- âœ… ì‹¤ì œ ì €ì¥í•˜ëŠ” ë‚ ì§œë§Œ DBì— ë°ì´í„° ìƒì„±í•˜ì—¬ íš¨ìœ¨ì„± ê·¹ëŒ€í™”
- âœ… ë‹¹ì¼ UX ë³´ì¥: ì¡°íšŒë§Œ í•´ë„ ì™„ì „í•œ ë£¨í‹´ ìƒíƒœ í‘œì‹œ
- âœ… ë¶ˆí•„ìš”í•œ ë°ì´í„° ë°©ì§€: ì¡°íšŒë§Œ í•˜ê³  ì €ì¥ ì•ˆ í•´ë„ DB ê¹”ë”
- âœ… ê³¼ê±° ë‚ ì§œ ì„±ëŠ¥: ê¸°ì¡´ ë°ì´í„°ë§Œ ì¡°íšŒí•˜ì—¬ ë¹ ë¥¸ ì‘ë‹µ

### B. ìŠ¤ëƒ…ìƒ· êµ¬ì„± ìš”ì†Œ

#### ìŠ¤ëƒ…ìƒ·ì— í¬í•¨ë˜ëŠ” ë£¨í‹´
- **ëŒ€ìƒ**: í•´ë‹¹ ë‚ ì§œ ê¸°ì¤€ ì‚¬ìš©ìì˜ ëª¨ë“  í™œì„± ë£¨í‹´ (ì‚­ì œë˜ì§€ ì•Šì€ ë£¨í‹´)
- **ì´ˆê¸° ìƒíƒœ**: `PerformanceLevel.NOT_PERFORMED`
- **ë°ì´í„°**: ë£¨í‹´ì˜ í˜„ì¬ ìŠ¤ëƒ…ìƒ· ì •ë³´ ì €ì¥ (ì œëª©, ì¹´í…Œê³ ë¦¬, ì„±ì¥ ì„¤ì • ë“±)

#### ë°ì´í„° êµ¬ì¡°
```java
DailyRoutineEntity {
    routine: RoutineEntity (ì°¸ì¡°)
    performanceLevel: NOT_PERFORMED (ì´ˆê¸°ê°’)
    consecutiveDays: 0 (ì´ˆê¸°ê°’)
    performedDate: í•´ë‹¹ ë‚ ì§œ
    // ë£¨í‹´ ìŠ¤ëƒ…ìƒ· í•„ë“œë“¤
    routineTitle, routineCategory, isGrowthMode, 
    targetType, targetValue, growthCycleDays, targetIncrement
}
```

## ğŸ”§ êµ¬í˜„ ê³„íš

### 1. API ì„¤ê³„

#### A. ìƒˆë¡œìš´ API ì—”ë“œí¬ì¸íŠ¸
```java
// 1. ë‹¹ì¼ ë£¨í‹´ í˜„í™© ì¡°íšŒ (ê°€ìƒ ë ˆì½”ë“œ í¬í•¨)
GET /api/daily-records/today
Response: í•­ìƒ ì™„ì „í•œ ë£¨í‹´ ìƒíƒœ ë°˜í™˜ (ê¸°ë¡ ì—†ìœ¼ë©´ ê°€ìƒ NOT_PERFORMED)

// 2. íŠ¹ì • ë‚ ì§œ ê¸°ë¡ ì¡°íšŒ (ê¸°ì¡´ ë°ì´í„°ë§Œ)
GET /api/daily-records/{date}
Response: ì‹¤ì œ ì €ì¥ëœ ê¸°ë¡ë§Œ ì¡°íšŒ (ê¸°ë¡ ì—†ìœ¼ë©´ ë¹ˆ ì‘ë‹µ)

// 3. ë‹¹ì¼ ê¸°ë¡ ì €ì¥ (ê¸°ì¡´ - ìŠ¤ëƒ…ìƒ· ìƒì„± ë¡œì§ ì¶”ê°€)
POST /api/daily-records/{date}
Request: SaveDailyRecordRequest
Response: ì €ì¥ëœ ì™„ì „í•œ ê¸°ë¡ ìƒíƒœ
```

#### B. Controller êµ¬í˜„
```java
@RestController
@RequestMapping("/api/daily-records")
@RequiredArgsConstructor
public class DailyRecordController {
    
    private final DailyRecordFacade dailyRecordFacade;
    
    /**
     * ë‹¹ì¼ ë£¨í‹´ í˜„í™© ì¡°íšŒ (ê°€ìƒ NOT_PERFORMED í¬í•¨)
     */
    @GetMapping("/today")
    public CommonApiResponse<DailyRecordResponse> getTodayRecord(
            @AuthenticationPrincipal Long userId) {
        DailyRecordResponse response = dailyRecordFacade.getTodayRecordWithVirtual(userId);
        return CommonApiResponse.success(ApiSuccessCode.SUCCESS, response);
    }
    
    /**
     * íŠ¹ì • ë‚ ì§œ ê¸°ë¡ ì¡°íšŒ (ì‹¤ì œ ì €ì¥ëœ ë°ì´í„°ë§Œ)
     */
    @GetMapping("/{date}")
    public CommonApiResponse<DailyRecordResponse> getDailyRecord(
            @AuthenticationPrincipal Long userId,
            @PathVariable @DateTimeFormat(pattern = "yyyy-MM-dd") LocalDate date) {
        DailyRecordResponse response = dailyRecordFacade.getDailyRecord(userId, date);
        return CommonApiResponse.success(ApiSuccessCode.SUCCESS, response);
    }
    
    /**
     * ì¼ì¼ ê¸°ë¡ ì €ì¥ (ìŠ¤ëƒ…ìƒ· ìƒì„± í¬í•¨)
     */
    @PostMapping("/{date}")
    public CommonApiResponse<DailyRecordResponse> saveDailyRecord(
            @AuthenticationPrincipal Long userId,
            @PathVariable @DateTimeFormat(pattern = "yyyy-MM-dd") LocalDate date,
            @RequestBody @Valid SaveDailyRecordRequest request) {
        DailyRecordResponse response = dailyRecordFacade.saveDailyRecord(userId, date, request);
        return CommonApiResponse.success(ApiSuccessCode.CREATED, response);
    }
}
```

### 2. Repository ê³„ì¸µ í™•ì¥

#### DailyRoutineRepository ì¶”ê°€ ë©”ì„œë“œ
```java
/**
 * íŠ¹ì • íšŒì›ì˜ íŠ¹ì • ë‚ ì§œì— ê¸°ë¡ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
 */
boolean existsByMemberIdAndPerformedDate(Long memberId, LocalDate date);

/**
 * ì¼ê´„ ì €ì¥ (ê¸°ì¡´ JpaRepository.saveAll í™œìš©)
 */
List<DailyRoutineEntity> saveAll(Iterable<DailyRoutineEntity> entities);
```

### 3. Service ê³„ì¸µ êµ¬í˜„

#### A. DailyRecordFacade í™•ì¥
```java
@Component
@RequiredArgsConstructor
public class DailyRecordFacade {
    
    private final DailyRecordCommandService commandService;
    private final DailyRecordQueryService queryService;
    
    /**
     * ë‹¹ì¼ ê¸°ë¡ ì¡°íšŒ (ê°€ìƒ ë ˆì½”ë“œ í¬í•¨)
     */
    @Transactional(readOnly = true)
    public DailyRecordResponse getTodayRecordWithVirtual(Long memberId) {
        LocalDate today = LocalDate.now();
        return queryService.getTodayRecordWithVirtual(memberId, today);
    }
    
    /**
     * íŠ¹ì • ë‚ ì§œ ê¸°ë¡ ì¡°íšŒ (ì‹¤ì œ ë°ì´í„°ë§Œ)
     */
    @Transactional(readOnly = true)
    public DailyRecordResponse getDailyRecord(Long memberId, LocalDate date) {
        return queryService.getDailyRecord(memberId, date);
    }
    
    /**
     * ì¼ì¼ ê¸°ë¡ ì €ì¥ (ìŠ¤ëƒ…ìƒ· ìƒì„± í¬í•¨)
     */
    @Transactional
    public DailyRecordResponse saveDailyRecord(Long memberId, LocalDate date, SaveDailyRecordRequest request) {
        return commandService.saveDailyRecord(memberId, date, request);
    }
}
```

#### B. DailyRecordQueryService í™•ì¥
```java
@Service
@RequiredArgsConstructor
@Transactional(readOnly = true)
public class DailyRecordQueryService {
    
    private final DailyReflectionService reflectionService;
    private final DailyRoutineService dailyRoutineService;
    private final RoutineService routineService;
    private final MemberRepository memberRepository;
    
    /**
     * ë‹¹ì¼ ê¸°ë¡ ì¡°íšŒ (ì‹¤ì œ ê¸°ë¡ + ê°€ìƒ NOT_PERFORMED ë¨¸ì§€)
     */
    public DailyRecordResponse getTodayRecordWithVirtual(Long memberId, LocalDate today) {
        Optional<DailyReflectionEntity> reflection = reflectionService.getReflection(memberId, today);
        
        // 1. í˜„ì¬ ëª¨ë“  í™œì„± ë£¨í‹´ ì¡°íšŒ
        List<RoutineEntity> allUserRoutines = routineService.getUserRoutines(memberId);
        
        // 2. ì‹¤ì œ ê¸°ë¡ëœ ë°ì´í„° ì¡°íšŒ
        List<DailyRoutineEntity> actualRecords = dailyRoutineService.getTodayRoutines(memberId, today);
        
        // 3. ì‹¤ì œ ê¸°ë¡ + ê°€ìƒ ê¸°ë¡ ë¨¸ì§€
        List<DailyRoutineEntity> completeRecords = mergeActualAndVirtualRecords(
            allUserRoutines, actualRecords, memberId, today);
        
        return DailyRecordResponse.of(reflection.orElse(null), completeRecords);
    }
    
    /**
     * íŠ¹ì • ë‚ ì§œ ê¸°ë¡ ì¡°íšŒ (ì‹¤ì œ ì €ì¥ëœ ë°ì´í„°ë§Œ)
     */
    public DailyRecordResponse getDailyRecord(Long memberId, LocalDate date) {
        Optional<DailyReflectionEntity> reflection = reflectionService.getReflection(memberId, date);
        List<DailyRoutineEntity> routineRecords = dailyRoutineService.getTodayRoutines(memberId, date);
        
        return DailyRecordResponse.of(reflection.orElse(null), routineRecords);
    }
    
    /**
     * ì‹¤ì œ ê¸°ë¡ê³¼ ê°€ìƒ ê¸°ë¡ì„ ë¨¸ì§€í•˜ì—¬ ì™„ì „í•œ ë£¨í‹´ ìƒíƒœ ìƒì„±
     * ì¤‘ê°„ì— ì¶”ê°€ëœ ë£¨í‹´ë„ ì¦‰ì‹œ NOT_PERFORMED ìƒíƒœë¡œ ë°˜ì˜
     */
    private List<DailyRoutineEntity> mergeActualAndVirtualRecords(
            List<RoutineEntity> allUserRoutines, 
            List<DailyRoutineEntity> actualRecords,
            Long memberId, 
            LocalDate date) {
        
        // ì´ë¯¸ ê¸°ë¡ëœ ë£¨í‹´ IDë“¤ ì¶”ì¶œ
        Set<Long> recordedRoutineIds = actualRecords.stream()
                .map(record -> record.getRoutine() != null ? record.getRoutine().getRoutineId() : null)
                .filter(Objects::nonNull)
                .collect(Collectors.toSet());
        
        // ê¸°ë¡ë˜ì§€ ì•Šì€ ë£¨í‹´ë“¤ì„ ê°€ìƒ NOT_PERFORMEDë¡œ ìƒì„±
        MemberEntity member = memberRepository.findById(memberId)
                .orElseThrow(() -> new BaseException(ErrorCode.MEMBER_NOT_FOUND));
        
        List<DailyRoutineEntity> virtualRecords = allUserRoutines.stream()
                .filter(routine -> !recordedRoutineIds.contains(routine.getRoutineId()))
                .map(routine -> createVirtualNotPerformedRecord(routine, member, date))
                .collect(Collectors.toList());
        
        // ì‹¤ì œ ê¸°ë¡ + ê°€ìƒ ê¸°ë¡ í•©ì¹˜ê¸°
        List<DailyRoutineEntity> completeRecords = new ArrayList<>(actualRecords);
        completeRecords.addAll(virtualRecords);
        
        return completeRecords;
    }
    
    /**
     * ë‹¨ì¼ ê°€ìƒ NOT_PERFORMED ë ˆì½”ë“œ ìƒì„±
     */
    private DailyRoutineEntity createVirtualNotPerformedRecord(
            RoutineEntity routine, MemberEntity member, LocalDate date) {
        return DailyRoutineEntity.builder()
                .dailyRoutineId(null) // ê°€ìƒ ê¸°ë¡ì´ë¯€ë¡œ ID ì—†ìŒ
                .routine(routine)
                .member(member)
                .performanceLevel(PerformanceLevel.NOT_PERFORMED)
                .consecutiveDays(0)
                .performedDate(date)
                .routineTitle(routine.getTitle())
                .routineCategory(routine.getCategory())
                .isGrowthMode(routine.getIsGrowthMode())
                .targetType(routine.getTargetType())
                .targetValue(routine.getTargetValue())
                .growthCycleDays(routine.getGrowthCycleDays())
                .targetIncrement(routine.getTargetIncrement())
                .build();
    }
}
```

#### C. DailyRecordDomainService í™•ì¥
```java
@Service
@RequiredArgsConstructor
@Transactional
public class DailyRecordDomainService {
    
    private final RoutineService routineService;
    private final MemberRepository memberRepository;
    private final DailyRoutineService dailyRoutineService;
    private final DailyRoutineRepository dailyRoutineRepository;
    
    /**
     * ìŠ¤ëƒ…ìƒ· ì¡´ì¬ ë³´ì¥ (ê³µí†µ ë©”ì„œë“œ)
     */
    public void ensureDailyRoutineSnapshotExists(Long memberId, LocalDate date) {
        if (!dailyRoutineRepository.existsByMemberIdAndPerformedDate(memberId, date)) {
            createInitialSnapshot(memberId, date);
        }
    }
    
    /**
     * ì´ˆê¸° ìŠ¤ëƒ…ìƒ· ìƒì„± (ì‹¤ì œ DB ì €ì¥)
     */
    private void createInitialSnapshot(Long memberId, LocalDate date) {
        List<RoutineEntity> activeRoutines = routineService.getUserRoutines(memberId);
        if (activeRoutines.isEmpty()) {
            return; // ë£¨í‹´ì´ ì—†ìœ¼ë©´ ìŠ¤ëƒ…ìƒ· ìƒì„±í•˜ì§€ ì•ŠìŒ
        }
        
        MemberEntity member = memberRepository.findById(memberId)
                .orElseThrow(() -> new BaseException(ErrorCode.MEMBER_NOT_FOUND));
        
        List<DailyRoutineEntity> initialRecords = activeRoutines.stream()
                .map(routine -> DailyRoutineEntity.create(routine, member, 
                    PerformanceLevel.NOT_PERFORMED, date, 0))
                .collect(Collectors.toList());
        
        dailyRoutineRepository.saveAll(initialRecords);
        
        log.info("Created daily routine snapshot for member: {} on date: {} with {} routines", 
                memberId, date, initialRecords.size());
    }
    
    // ê¸°ì¡´ ë©”ì„œë“œë“¤...
    public List<DailyRoutineEntity> saveRoutineRecords(Long memberId, LocalDate date, 
                                                      List<RoutineRecordRequest> routineRecords) {
        if (routineRecords == null || routineRecords.isEmpty()) {
            return new ArrayList<>();
        }
        
        List<RoutinePerformanceRequest> enrichedRecords = enrichRoutineRecords(routineRecords, memberId);
        return dailyRoutineService.saveRoutineRecords(memberId, date, enrichedRecords);
    }
    
    // ê¸°ì¡´ ê²€ì¦ ë©”ì„œë“œë“¤ ìœ ì§€...
}
```

#### D. DailyRecordCommandService ìˆ˜ì •
```java
@Service
@RequiredArgsConstructor
@Transactional
public class DailyRecordCommandService {
    
    private final DailyRecordDomainService domainService;
    private final DailyReflectionService reflectionService;
    
    public DailyRecordResponse saveDailyRecord(Long memberId, LocalDate date, SaveDailyRecordRequest request) {
        domainService.validateDateModifiable(date);
        
        // ìŠ¤ëƒ…ìƒ· ë³´ì¥ (ìƒˆ ë¡œì§ - ì²« ì €ì¥ ì‹œ ì‹¤ì œ DB ì €ì¥)
        domainService.ensureDailyRoutineSnapshotExists(memberId, date);
        
        DailyReflectionEntity reflection = saveReflectionIfPresent(memberId, date, request);
        List<DailyRoutineEntity> routineRecords = domainService.saveRoutineRecords(
            memberId, date, request.getRoutineRecords());
        
        return DailyRecordResponse.of(reflection, routineRecords);
    }
    
    private DailyReflectionEntity saveReflectionIfPresent(Long memberId, LocalDate date, 
                                                         SaveDailyRecordRequest request) {
        if (request.getReflection() == null) {
            return null;
        }
        
        return reflectionService.saveReflection(
            memberId, date, 
            request.getReflection().getContent(),
            request.getReflection().getEmotion()
        );
    }
}
```

## ğŸ”„ ë™ì‘ í”Œë¡œìš°

### A. ì €ì¥ ì‹œë‚˜ë¦¬ì˜¤
```
1. ì‚¬ìš©ìê°€ 2024-01-15 ë£¨í‹´ ê¸°ë¡ ì €ì¥ ìš”ì²­
2. ensureDailyRoutineSnapshotExists(memberId, 2024-01-15) í˜¸ì¶œ
3. í•´ë‹¹ ë‚ ì§œ ê¸°ë¡ ì¡´ì¬ í™•ì¸
   - ê¸°ë¡ ì—†ìŒ â†’ í˜„ì¬ í™œì„± ë£¨í‹´ 5ê°œì— ëŒ€í•´ NOT_PERFORMEDì„ DBì— ì‹¤ì œ ì €ì¥
   - ê¸°ë¡ ìˆìŒ â†’ ìŠ¤í‚µ
4. ì‹¤ì œ ê¸°ë¡ ì—…ë°ì´íŠ¸ (ìš´ë™A: FULL_SUCCESS, ë…ì„œB: PARTIAL_SUCCESS)
5. ìµœì¢… ê²°ê³¼: 5ê°œ ë£¨í‹´ ëª¨ë‘ ì ì ˆí•œ ìƒíƒœë¡œ DB ì €ì¥
```

### B. ë‹¹ì¼ ì¡°íšŒ ì‹œë‚˜ë¦¬ì˜¤ (ë¨¸ì§€ ë°©ì‹)
```
1. ì‚¬ìš©ìê°€ ì˜¤ëŠ˜ ë‚ ì§œ(2024-01-15) ë£¨í‹´ ê¸°ë¡ ì¡°íšŒ ìš”ì²­
2. í˜„ì¬ í™œì„± ë£¨í‹´ 3ê°œ ì¡°íšŒ (ìš´ë™A, ë…ì„œB, ëª…ìƒC)
3. ì‹¤ì œ ê¸°ë¡ í™•ì¸ â†’ ìš´ë™Aë§Œ FULL_SUCCESSë¡œ ê¸°ë¡ë¨
4. ë¨¸ì§€ ë¡œì§ ì‹¤í–‰:
   - ìš´ë™A: ì‹¤ì œ ê¸°ë¡ (FULL_SUCCESS)
   - ë…ì„œB, ëª…ìƒC: ê°€ìƒ ê¸°ë¡ (NOT_PERFORMED) 
5. ì‚¬ìš©ìëŠ” 3ê°œ ë£¨í‹´ ëª¨ë‘ì˜ ìƒíƒœ í™•ì¸ (1ê°œ ì™„ë£Œ, 2ê°œ ë¯¸ìˆ˜í–‰)
```

### C. ê³¼ê±° ë‚ ì§œ ì¡°íšŒ ì‹œë‚˜ë¦¬ì˜¤
```
1. ì‚¬ìš©ìê°€ 2024-01-10 ë£¨í‹´ ê¸°ë¡ ì¡°íšŒ ìš”ì²­
2. í•´ë‹¹ ë‚ ì§œ ì‹¤ì œ ê¸°ë¡ë§Œ ì¡°íšŒ
3. ê¸°ë¡ì´ ìˆìœ¼ë©´ â†’ ì €ì¥ëœ ìŠ¤ëƒ…ìƒ· ë°˜í™˜
4. ê¸°ë¡ì´ ì—†ìœ¼ë©´ â†’ ë¹ˆ ì‘ë‹µ ë°˜í™˜ ("ê¸°ë¡ ì—†ìŒ" UI)
```

## ğŸ“Š ì˜ˆìƒ ì˜í–¥ë„

### ë°ì´í„°ë² ì´ìŠ¤
- **ì €ì¥ ê³µê°„**: ì‹¤ì œ ì‚¬ìš©í•˜ëŠ” ë‚ ì§œë§Œ ê¸°ë¡í•˜ë¯€ë¡œ ì ì • ìˆ˜ì¤€
- **ì¿¼ë¦¬ ì„±ëŠ¥**: ë‹¨ìˆœ ì¡´ì¬ ì—¬ë¶€ í™•ì¸ + ì¼ê´„ ì‚½ì…ìœ¼ë¡œ ìµœì í™”
- **ì¸ë±ìŠ¤**: `(member_id, performed_date)` ë³µí•© ì¸ë±ìŠ¤ í™œìš©

### ì„±ëŠ¥
- **ì´ˆê¸° ì§€ì—°**: ì²« ì¡°íšŒ/ì €ì¥ ì‹œ ìŠ¤ëƒ…ìƒ· ìƒì„±ìœ¼ë¡œ ì•½ê°„ì˜ ì§€ì—° ë°œìƒ
- **í›„ì† ì²˜ë¦¬**: ë‘ ë²ˆì§¸ í˜¸ì¶œë¶€í„°ëŠ” ê¸°ì¡´ê³¼ ë™ì¼í•œ ì„±ëŠ¥
- **ë©”ëª¨ë¦¬**: ë£¨í‹´ ìˆ˜ì— ë¹„ë¡€í•˜ëŠ” ì„ì‹œ ê°ì²´ ìƒì„±

### ì‚¬ìš©ì ê²½í—˜
- **ì¼ê´€ì„±**: ëª¨ë“  ë‚ ì§œì—ì„œ ì™„ì „í•œ ë£¨í‹´ ìƒíƒœ í™•ì¸ ê°€ëŠ¥
- **ì§ê´€ì„±**: ëª…ì‹œì ìœ¼ë¡œ ë¯¸ìˆ˜í–‰ ìƒíƒœ í‘œì‹œ
- **íˆìŠ¤í† ë¦¬**: ê³¼ê±° ì‹œì ì˜ ì •í™•í•œ ë£¨í‹´ ëª©ë¡ ë³´ì¡´

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### 1. ê¸°ë³¸ ì‹œë‚˜ë¦¬ì˜¤
- [ ] ë¹ˆ ë‚ ì§œì— ì²« ê¸°ë¡ ì €ì¥ ì‹œ ì „ì²´ ìŠ¤ëƒ…ìƒ· ìƒì„± í™•ì¸
- [ ] ê¸°ì¡´ ê¸°ë¡ì´ ìˆëŠ” ë‚ ì§œ ì¶”ê°€ ì €ì¥ ì‹œ ìŠ¤ëƒ…ìƒ· ìƒì„± ìŠ¤í‚µ í™•ì¸
- [ ] ê¸°ë¡ ì—†ëŠ” ë‚ ì§œ ì¡°íšŒ ì‹œ ìŠ¤ëƒ…ìƒ· ìƒì„± í›„ ì¡°íšŒ í™•ì¸

### 2. ì—ì§€ ì¼€ì´ìŠ¤
- [ ] ë£¨í‹´ì´ ì—†ëŠ” ì‚¬ìš©ìì˜ ê¸°ë¡ ì €ì¥/ì¡°íšŒ
- [ ] ê³¼ê±° ë‚ ì§œì™€ í˜„ì¬ ë‚ ì§œì˜ ë£¨í‹´ ëª©ë¡ ì°¨ì´ í™•ì¸
- [ ] ë£¨í‹´ ì‚­ì œ í›„ ê³¼ê±° ê¸°ë¡ ì¡°íšŒ ì‹œ ë°ì´í„° ë³´ì¡´ í™•ì¸

### 3. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] ë‹¤ìˆ˜ ë£¨í‹´ ë³´ìœ  ì‚¬ìš©ìì˜ ìŠ¤ëƒ…ìƒ· ìƒì„± ì‹œê°„ ì¸¡ì •
- [ ] ë™ì‹œ ë‹¤ë°œì  ë‚ ì§œë³„ ì¡°íšŒ/ì €ì¥ ì„±ëŠ¥ í™•ì¸

## ğŸš€ êµ¬í˜„ ë‹¨ê³„ë³„ ì²´í¬ë¦¬ìŠ¤íŠ¸

### 1ë‹¨ê³„: Repository ê³„ì¸µ êµ¬í˜„
- [ ] `DailyRoutineRepository.existsByMemberIdAndPerformedDate()` ë©”ì„œë“œ ì¶”ê°€
- [ ] Repository ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± ë° ì‹¤í–‰

### 2ë‹¨ê³„: Domain Service êµ¬í˜„
- [ ] `DailyRecordDomainService.ensureDailyRoutineSnapshotExists()` êµ¬í˜„
- [ ] `DailyRecordDomainService.createInitialSnapshot()` êµ¬í˜„
- [ ] Domain Service ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±

### 3ë‹¨ê³„: Query Service í™•ì¥
- [ ] `DailyRecordQueryService.getTodayRecordWithVirtual()` êµ¬í˜„ (ë¨¸ì§€ ë°©ì‹)
- [ ] `DailyRecordQueryService.mergeActualAndVirtualRecords()` êµ¬í˜„
- [ ] ê°€ìƒ ë ˆì½”ë“œ ìƒì„± ë° ë¨¸ì§€ ë¡œì§ í…ŒìŠ¤íŠ¸

### 4ë‹¨ê³„: Command Service ìˆ˜ì •
- [ ] `DailyRecordCommandService.saveDailyRecord()` ìŠ¤ëƒ…ìƒ· ë¡œì§ ì¶”ê°€
- [ ] ê¸°ì¡´ ì €ì¥ ë¡œì§ê³¼ í†µí•© í…ŒìŠ¤íŠ¸

### 5ë‹¨ê³„: Facade ê³„ì¸µ í™•ì¥
- [ ] `DailyRecordFacade.getTodayRecordWithVirtual()` êµ¬í˜„
- [ ] íŠ¸ëœì­ì…˜ ê²½ê³„ ì„¤ì • í™•ì¸

### 6ë‹¨ê³„: Controller API êµ¬í˜„
- [ ] `GET /api/daily-records/today` ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
- [ ] ê¸°ì¡´ `GET /api/daily-records/{date}` ë™ì‘ í™•ì¸
- [ ] `POST /api/daily-records/{date}` ìŠ¤ëƒ…ìƒ· ë¡œì§ í†µí•©

### 7ë‹¨ê³„: í†µí•© í…ŒìŠ¤íŠ¸
- [ ] **ë‹¹ì¼ ì²« ì¡°íšŒ** â†’ ëª¨ë“  ë£¨í‹´ NOT_PERFORMED ìƒíƒœ ë°˜í™˜ í™•ì¸
- [ ] **ë‹¹ì¼ ë¶€ë¶„ ê¸°ë¡ í›„ ì¡°íšŒ** â†’ ì‹¤ì œ ê¸°ë¡ + ê°€ìƒ ê¸°ë¡ ë¨¸ì§€ í™•ì¸
- [ ] **ë‹¹ì¼ ë£¨í‹´ ì¶”ê°€ í›„ ì¡°íšŒ** â†’ ìƒˆ ë£¨í‹´ ì¦‰ì‹œ NOT_PERFORMED ë°˜ì˜ í™•ì¸
- [ ] **ë‹¹ì¼ ì²« ì €ì¥** â†’ ì‹¤ì œ ìŠ¤ëƒ…ìƒ· ìƒì„± í™•ì¸
- [ ] **ê³¼ê±° ë‚ ì§œ ì¡°íšŒ** â†’ ê¸°ì¡´ ë°ì´í„°ë§Œ ë°˜í™˜ í™•ì¸
- [ ] **ë¹ˆ ê³¼ê±° ë‚ ì§œ ì¡°íšŒ** â†’ ë¹ˆ ì‘ë‹µ ë°˜í™˜ í™•ì¸

### 8ë‹¨ê³„: API ë¬¸ì„œ ì—…ë°ì´íŠ¸
- [ ] Swagger ë¬¸ì„œ ì—…ë°ì´íŠ¸
- [ ] API ëª…ì„¸ì„œ ì—…ë°ì´íŠ¸ (`/api-docs/DAILY_API_SPECIFICATION.md`)

## ğŸ§ª í•µì‹¬ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### A. ë‹¹ì¼ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
```java
@Test
void ë‹¹ì¼_ì¡°íšŒ_ì‹œ_ë£¨í‹´ì—†ìœ¼ë©´_ê°€ìƒë ˆì½”ë“œ_ë°˜í™˜() {
    // Given: ì˜¤ëŠ˜ ë‚ ì§œ, ë£¨í‹´ 3ê°œ ì¡´ì¬, ê¸°ë¡ ì—†ìŒ
    // When: GET /api/daily-records/today í˜¸ì¶œ
    // Then: 3ê°œ ë£¨í‹´ ëª¨ë‘ NOT_PERFORMED ìƒíƒœë¡œ ë°˜í™˜, DB ì €ì¥ ì•ˆë¨
}

@Test
void ë‹¹ì¼_ì²«ì €ì¥_ì‹œ_ìŠ¤ëƒ…ìƒ·_ìƒì„±() {
    // Given: ì˜¤ëŠ˜ ë‚ ì§œ, ë£¨í‹´ 3ê°œ ì¡´ì¬, ê¸°ë¡ ì—†ìŒ
    // When: POST /api/daily-records/2024-01-15 í˜¸ì¶œ
    // Then: 3ê°œ ë£¨í‹´ NOT_PERFORMED ìŠ¤ëƒ…ìƒ· DB ì €ì¥, ì‹¤ì œ ê¸°ë¡ ì—…ë°ì´íŠ¸
}
```

### B. ê³¼ê±° ë‚ ì§œ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
```java
@Test
void ê³¼ê±°ë‚ ì§œ_ì¡°íšŒ_ì‹œ_ê¸°ì¡´ë°ì´í„°ë§Œ_ë°˜í™˜() {
    // Given: ê³¼ê±° ë‚ ì§œ, ì €ì¥ëœ ê¸°ë¡ ì¡´ì¬
    // When: GET /api/daily-records/2024-01-10 í˜¸ì¶œ
    // Then: ì‹¤ì œ ì €ì¥ëœ ê¸°ë¡ë§Œ ë°˜í™˜
}

@Test
void ê³¼ê±°ë‚ ì§œ_ë¹ˆì¡°íšŒ_ì‹œ_ë¹ˆì‘ë‹µ_ë°˜í™˜() {
    // Given: ê³¼ê±° ë‚ ì§œ, ì €ì¥ëœ ê¸°ë¡ ì—†ìŒ
    // When: GET /api/daily-records/2024-01-05 í˜¸ì¶œ
    // Then: ë¹ˆ routineRecords ë°˜í™˜
}
```

### C. ì—ì§€ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸
```java
@Test
void ë£¨í‹´ì—†ëŠ”_ì‚¬ìš©ì_ë‹¹ì¼ì¡°íšŒ() {
    // Given: ì‚¬ìš©ìì—ê²Œ ë£¨í‹´ ì—†ìŒ
    // When: GET /api/daily-records/today í˜¸ì¶œ
    // Then: ë¹ˆ routineRecords ë°˜í™˜
}

@Test
void ë£¨í‹´_ì¤‘ê°„ì¶”ê°€_í›„_ë‹¹ì¼ì¡°íšŒ() {
    // Given: ì˜¤ì „ì— ë£¨í‹´A ê¸°ë¡ ì €ì¥, ì˜¤í›„ì— ìƒˆ ë£¨í‹´B ì¶”ê°€
    // When: GET /api/daily-records/today í˜¸ì¶œ
    // Then: ë£¨í‹´A(ì‹¤ì œ ê¸°ë¡) + ë£¨í‹´B(ê°€ìƒ NOT_PERFORMED) ëª¨ë‘ ë°˜í™˜
}

@Test
void ë‹¹ì¼_ë¶€ë¶„ê¸°ë¡_í›„_ì¡°íšŒ() {
    // Given: ë£¨í‹´ 3ê°œ ì¡´ì¬, 1ê°œë§Œ ê¸°ë¡ ì €ì¥
    // When: GET /api/daily-records/today í˜¸ì¶œ
    // Then: 1ê°œ ì‹¤ì œ ê¸°ë¡ + 2ê°œ ê°€ìƒ NOT_PERFORMED ë°˜í™˜
}
```

## ğŸ” ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­

### ìµœì í™” í¬ì¸íŠ¸
1. **Repository ì¿¼ë¦¬**: `existsByMemberIdAndPerformedDate` ì¸ë±ìŠ¤ ìµœì í™”
2. **ê°€ìƒ ë ˆì½”ë“œ ìƒì„±**: ë©”ëª¨ë¦¬ íš¨ìœ¨ì ì¸ Stream ì²˜ë¦¬
3. **íŠ¸ëœì­ì…˜ ê²½ê³„**: Command/Query ë¶„ë¦¬ë¡œ ì½ê¸° ì„±ëŠ¥ ë³´ì¥

### ëª¨ë‹ˆí„°ë§ ë©”íŠ¸ë¦­
- ìŠ¤ëƒ…ìƒ· ìƒì„± ë¹ˆë„ ë° ì†Œìš” ì‹œê°„
- ê°€ìƒ ë ˆì½”ë“œ ìƒì„± ì„±ëŠ¥
- API ì‘ë‹µ ì‹œê°„ (íŠ¹íˆ `/today` ì—”ë“œí¬ì¸íŠ¸)

---

**ìµœì¢… ìˆ˜ì •ì¼**: 2025-01-09  
**êµ¬í˜„ ë‹´ë‹¹**: Development Team  
**ê²€í†  ìƒíƒœ**: Ready for Implementation  
**ì˜ˆìƒ êµ¬í˜„ ì‹œê°„**: 1-2ì¼